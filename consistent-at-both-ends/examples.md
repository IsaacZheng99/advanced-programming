# 双端一致

## 1. 写在前面

- 笔者这里记录的双端一致问题主要是保持流程一致。

## 2. 好处

以下总结了一些个人认为保持双端一致的好处：

- 减少bug。一般情况下，程序和策划对接好需求后，客户端和服务端的同事会统一功能流程并确定相关协议，但是部分情况下双端流程有差别，仍能够看似正确地获取最后的结果，但同时也埋下了隐患，例如：如果服务端代码是A -> B -> C的流程，而客户端是A -> C -> B的流程，当服务端发现bug出现在A之后，此时客户端可能就在C模块中找问题，而服务端则在B模块找问题，最终会影响到问题的定位。
- 安全性问题。服务端的一个重要责任就是保证安全性，涉及到例如奖励相关或者随机结果相关的处理，就需要谨慎对待客户端传过来的数据了（当然“不相信客户端”是时刻都要注意的，这里只是强调部分情况下需要更加重视），如果双端不保持一致，就可能会有作弊的空间了。

# 3. 示例

- 随机。
  - 一般我们有两种情况：一是客户端发起请求，服务端完成随机后返回结果给客户端；另外一种情况是客户端和服务端都进行随机，客户端的随机仅用于表现，而结果还是由服务器控制，当然此时就不需要把结果返回给客户端了。
  - 针对上面提到的第二种情况，笔者在这里提供一种方法：
    - 通过随机种子以及相应的算法计算，最终会得到一个随机数
    - 当算法和随机种子确定时，最后的随机结果也是固定的，因此只需要客户端和服务端使用相同的随机算法和随机种子，就可以保证双端的随机结果一致了。同时，为了进一步保证安全性，还可以要求客户端将部分数据传给服务端，服务端可以对比正确数据进行校验，这样可以额外确认客户端是否存在尝试作弊的行为。（注意即使客户端不传数据，服务端也是安全的，这里传数据只是为了确认客户端没有作弊。）
